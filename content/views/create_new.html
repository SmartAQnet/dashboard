<div class="main container">
    <div class="row py-2">
        <div class="col-md-12">
            <div class="card" >
                <div class="card-header">
                    <h2>Create a Database Entry for a new Thing or add Sensors/Datastreams to an existing Thing</h3>
                </div>
                <div class="card-body">

                    <h3>Thing</h3>

                    <div class="input-group">
                        <div class="input-group-prepend">
                            <button type="button" class="btn btn-primary btn-sm btn-add-entity m-0" data-toggle="modal" data-target="#newThing"><i class="fa fa-cube"></i> Create a new Thing <span class="fa"></span></button>
                        </div>
                        <span class="input-group-text mx-5">or</span>
                        <select class="custom-select" id="thing-select" ng-model="newThing" ng-options="x.name for x in thingsList track by x['@iot.id']" ng-change="getSensorsofThing(newThing['@iot.id'])">
                            <option value="" disabled selected>select an existing Thing</option>
                        </select>
                    </div>


                    to add Sensors and/or Datastreams to.

                    <div class="row">
                        <div class="col">
                            <h4>
                                <div class="badge badge-success" style="float: right">
                                    ID: {{ newThing['@iot.id'] }}
                                </div>
                            </h4>
                        </div>
                    </div>

                    <!-- Create Thing Modal -->
                    <div class="modal fade" id="newThing" role="dialog">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header p-3 mb-2 bg-primary text-white">
                                    <!-- <button type="button" class="close" data-dismiss="modal">*</button> -->
                                    <h2 class="modal-title"><i class="fa fa-cube"></i>NEW DEVICE</h2>
                                </div>
                                <div class="modal-body">
                                    <div>
                                        <h3 class="modal-title">Thing</h3>
                                        <div class="input-group">
                                            <span class="input-group-addon" >Name: </span>
                                            <input class="form-control" type="text" placeholder="Example: Crowdsensing Node (SDS011, 180232)" ng-model="newThing.name" aria-describedby="thingnamehelpblock" />
                                            <small id="thingnamehelpblock" class="form-text text-muted">Human readable name of the thing. </small>
                                        </div>
                                        <div class="input-group">
                                            <span class="input-group-addon" >Description: </span>
                                            <input class="form-control" type="text" placeholder="Example: Low Cost Node Measuring Particulate Matter" ng-model="newThing.description" aria-describedby="thingdescriptionhelpblock"/>
                                            <small id="thingdescriptionhelpblock" class="form-text text-muted">Human readable description of the thing. </small>
                                        </div>
                                        <h5 class="modal-title">Properties: </h5>
                                        <div class="indent-inputlines">
                                            <div class="form-group">
                                                <label for="deviceidInput">Device ID: </label>
                                                <input class="form-control" id="deviceidInput" type="text" onkeyup="this.value = this.value.toLowerCase().replace(/ /g, '_');" placeholder="Example: 180232" ng-model="newThing.properties['device_id']" aria-describedby="thingpropertiesdeviceidhelpblock">
                                                <small id="thingpropertiesdeviceidhelpblock" class="form-text text-muted">Some Identifier of the Thing. <span class="text-warning">Necessary for ID generation. Only Lowercase Letters. </span></small>
                                            </div>
                                            <div class="form-group">
                                                <label for="devicenameInput">Device Name: </label>
                                                <input class="form-control" id="devicenameInput" type="text" onkeyup="this.value = this.value.toLowerCase().replace(/ /g, '_');" placeholder="Example: crowdsensor" ng-model="newThing.properties['device_name']" aria-describedby="thingpropertiesdevicenamehelpblock"> 
                                                <small id="thingpropertiesdevicenamehelpblock" class="form-text text-muted">Short Name of the Thing. <span class="text-warning">Necessary for ID generation. Only Lowercase Letters. </span></small>
                                            </div>
                                            <div class="form-group">
                                                <label for="operatorurlInput">Device Operator URL: </label>
                                                <input class="form-control" id="operatorurlInput" type="text" onkeyup="this.value = this.value.toLowerCase().replace(/ /g, '_');" placeholder="Example: teco.edu" ng-model="newThing.properties['operator_url']" aria-describedby="thingpropertiesoperatorurlhelpblock">
                                                <small id="thingpropertiesoperatorurlhelpblock" class="form-text text-muted">Operator URL of the Thing. <span class="text-warning">Necessary for ID generation. Only Lowercase Letters. </span></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <input type="submit" class="btn btn-default" ng-click="pushToServer(newThing)" value="Push to Server" />
                                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Close" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal end -->
                
                    <hr>

                    <h3>Sensors</h3> <!-- make angular display this only when a thing is chosen, otherwise a message that no thing was chosen-->

                    <div class="input-group">
                        <div class="input-group-prepend">
                            <button type="button" class="btn btn-primary btn-sm btn-add-entity m-0" data-toggle="modal" data-target="#newSensor"><i class="fa fa-plus"></i> Create a new Sensor (type)<span class="fa"></span></button>
                        </div>
                        <span class="input-group-text mx-5">or</span>
                        <select class="custom-select" id="sensor-select" ng-model="newSensor" ng-options="x.name for x in sensorsList track by x['@iot.id']">
                            <option value="" disabled selected>select an existing Sensor (type)</option>
                        </select>
                    </div>

                    <!-- remove button inactive (grau) wenn er schon serverseitig angelegt ist -->
                    <!-- add button functionality: wenn schon angehÃ¤ngt, werfe fehlermeldung (ID vergleich) -->


                    <div>
                        <table class="table table-bordered table-hover st-table table-striped table-sm">
                            <thead class="st-thead">
                            <tr>
                                <th>Name</th>
                                <th>ID</th>
                                <th style="text-align: center; width:66px">Add</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr>
                                <td ng-click="sensorClicked(x['@iot.id'])" ng-if="newSensor">{{newSensor["name"]}}</td>
                                <td ng-click="sensorClicked(x['@iot.id'])" ng-if="newSensor">{{newSensor["@iot.id"]}}</td>
                                <td style="text-align: center;" ng-if="newSensor" ng-init="newSensor = undefined"><button type="button" class="btn btn-primary btn-sm m-0" ng-click="addSensortoThing(newSensor)" ng-disabled="originalSensorList.includes(newSensor)"><i class="fa fa-plus"></i><span class="fa"></span></button></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <div>
                        <table class="table table-bordered table-hover st-table table-striped table-sm">
                            <thead class="st-thead">
                            <tr>
                                <th>Name</th>
                                <th>ID</th>
                                <th style="text-align: center; width:66px">Remove</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr ng-repeat="x in thisThingsSensorsList">
                                <td ng-click="sensorClicked(x['@iot.id'])">{{x["name"]}}</td>
                                <td ng-click="sensorClicked(x['@iot.id'])">{{x["@iot.id"]}}</td>
                                <td style="text-align: center;"><button type="button" class="btn btn-primary btn-sm m-0" ng-click="removeSensorfromThing(x)" ng-disabled="originalSensorList.includes(x)"><i class="fa fa-minus"></i> <span class="fa"></span></button></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>


                    <hr>

                    <h3>Datastreams</h3> <!-- make angular display this only when at least one sensor is chosen, otherwise a message that no sensor/thing was chosen-->


                    <div class="row">
                        <button type="button" class="btn btn-primary btn-sm btn-add-entity m-0" data-toggle="modal" data-target="#newDatastream"><i class="fa fa-plus"></i> Create a new Datastream<span class="fa"></span></button>
                    </div>

                    <div class="row" ng-repeat="datastream in datastreams">
                        <div class="col-1"></div>
                        <div class="col-7">
                        <button type="button" class="btn btn-primary btn-sm btn-add-entity m-0" data-toggle="modal" data-target="#newDatastream" ng-click="newDatastream=datastream">{{ datastream.name }}</button>
                        </div>
                        <div class="col-4">
                            <h4>
                                <div class="badge badge-success" style="float: right">
                                    ID: {{ newDatastream['@iot.id'] }}
                                </div>
                            </h4>
                        </div>
                    </div>

                    <!-- <select class="custom-select" id="sensor-select" ng-model="newSensor" ng-options="x.name for x in thisThingsSensorsList track by x['@iot.id']">
                        <option value="" disabled selected>select an existing Sensor (type)</option>
                    </select> -->


                    <!-- Create Datastream Modal -->
                    <div class="modal fade" id="newDatastream" role="dialog">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header p-3 mb-2 bg-primary text-white">
                                    <!-- <button type="button" class="close" data-dismiss="modal">*</button> -->
                                    <h2 class="modal-title"><i class="fa fa-cube"></i>NEW DEVICE</h2>
                                </div>
                                <div class="modal-body">
                                    <div>
                                        <h3 class="modal-title">Datastream</h3>
                                        <div class="input-group">
                                            <span class="input-group-addon" >Name: </span>
                                            <input class="form-control" type="text" placeholder="Example: PM10 Datastream of Crowdsensing Node (SDS011, 180232)" ng-model="newDatastream.name" />
                                        </div>
                                        <div class="input-group">
                                            <span class="input-group-addon" >Description: </span>
                                            <input class="form-control" type="text" placeholder="Example: Datastream for recording Particulate Matter" ng-model="newDatastream.description" />
                                        </div>
                                        <h5 class="modal-title">Properties: </h5>
                                        <div class="indent-inputlines">
                                            <h6 class="modal-title">License: </h6>
                                            <div class="indent-inputlines">
                                                <div class="form-group">
                                                    <label for="licensetypeInput">Type: </label>
                                                    <input class="form-control" id="licensetypeInput" type="text" placeholder="Example: CC BY 4.0" ng-model="newDatastream.properties['device_id']">
                                                </div>
                                                <div class="form-group">
                                                    <label for="licenseownerInput">Owner: </label>
                                                    <input class="form-control" id="licenseownerInput" type="text" placeholder="Example: Max Musterfrau" ng-model="newDatastream.properties['license']['owner']">
                                                </div>
                                                <div class="form-group">
                                                    <label for="licensemetadataInput">Metadata: </label>
                                                    <input class="form-control" id="licensemetadataInput" type="text" placeholder="Example: https://creativecommons.org/licenses/by/4.0/deed.de" ng-model="newDatastream.properties['license']['metadata']">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="sensorserialnumberInput">Sensor Serial Number: </label>
                                                <input class="form-control" id="sensorserialnumberInput" type="text" placeholder="Example: 5002-6666" ng-model="newDatastream.properties['sensor_serial_number']">
                                            </div>
                                            <div class="form-group">
                                                    <label for="sensorameInput">Sensor Name: </label>
                                                    <input class="form-control" id="sensorameInput" type="text" placeholder="Example: sds011" ng-model="newDatastream.properties['sensor_name']">
                                            </div>
                                            <div class="form-group">
                                                <label for="datastreamopertorurlInput">Datastream Operator URL: </label>
                                                <input class="form-control" id="datastreamopertorurlInput" type="text" placeholder="Example: teco.edu" ng-model="newDatastream.properties['operator_url']">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <input type="submit" class="btn btn-default" ng-click="addNewDatastream(newDatastream)" value="Save" />
                                    <input type="button" class="btn btn-default" data-dismiss="modal" value="Close" />
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Modal end -->

                    <!-- abfrage observed property in das datastream modal rein zur auswahl. falls nicht vorhanden inline anlegen?-->
                    <div class="row">
                        <div class="col">
                            <div class="form-group">
                                <label for="obsprop-select">Select Observed Property:</label>
                                <select class="custom-select" id="obsprop-select">
                                    <option selected> -- None Selected --</option>
                                    <option ng-repeat="x in obspropList" value="{{x['@iot.id']}}"> {{x["name"]}}</option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
